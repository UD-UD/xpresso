"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_couchbase_1 = require("nativescript-couchbase");
var CouchdbService = /** @class */ (function () {
    function CouchdbService() {
        this.DATABASE_NAME = "user-database";
    }
    CouchdbService.prototype.initCouch = function () {
        if (this.database == undefined) {
            this.database = new nativescript_couchbase_1.Couchbase(this.DATABASE_NAME); //create db if not present or getinstance
            this.database.createView("getUserData", "1", function (document, emitter) {
                if (document.userdata) {
                    emitter.emit(document._id, document);
                }
            });
        }
    };
    CouchdbService.prototype.createUserDataEntry = function (userdata) {
        this.initCouch();
        return this.database.createDocument({
            "userdata": userdata
        });
    };
    CouchdbService.prototype.getCouchData = function () {
        if (this.rows == undefined || this.rows.length == 0) {
            this.initCouch();
            var rows = this.database.executeQuery("getUserData");
            for (var i = 0; i < rows.length; i++) {
                console.log(i);
                console.log(JSON.stringify(rows[i]));
            }
            this.rows = rows;
        }
        return this.rows;
    };
    CouchdbService.prototype.setUserData = function (userdata) {
        if (this.getCouchData().length == 0) {
            console.log(this.createUserDataEntry(userdata));
            //  this.DocId = this.createUserDataEntry(userdata)
        }
        else {
            this.getCouchData();
        }
    };
    CouchdbService.prototype.updateUserData = function (docId, userdata) {
        this.database.updateDocument(docId, { "userdata": userdata });
    };
    CouchdbService.prototype.checkLoggedInStatus = function () {
        this.initCouch();
        var rows = this.getCouchData();
        if (rows.length != 0) {
            if (rows[0].userdata) {
                return rows[0].userdata.isLoggedIn ? true : false;
            }
        }
        else
            return false;
    };
    CouchdbService.prototype.getMessages = function () {
        if (this.rows == undefined || this.rows.length == 0) {
            this.getCouchData();
        }
        return this.rows[0].userdata.messages;
    };
    CouchdbService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], CouchdbService);
    return CouchdbService;
}());
exports.CouchdbService = CouchdbService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291Y2hkYi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY291Y2hkYi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLGlFQUFtRDtBQUtuRDtJQU1FO1FBSEEsa0JBQWEsR0FBRyxlQUFlLENBQUM7SUFHaEIsQ0FBQztJQUVULGtDQUFTLEdBQWpCO1FBQ0UsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUMsQ0FBQSxDQUFDO1lBQzdCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxrQ0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLHlDQUF5QztZQUM1RixJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFLFVBQVMsUUFBUSxFQUFFLE9BQU87Z0JBQ3JFLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUNuQixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ3pDLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0lBRU8sNENBQW1CLEdBQTNCLFVBQTRCLFFBQW1CO1FBQzdDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUM7WUFDbEMsVUFBVSxFQUFHLFFBQVE7U0FDdEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHFDQUFZLEdBQVo7UUFDRSxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLFNBQVMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDO1lBQ2xELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNqQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNyRCxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDWixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxDQUFDO1lBQ0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbkIsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFFRCxvQ0FBVyxHQUFYLFVBQVksUUFBbUI7UUFDN0IsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FDbkMsQ0FBQztZQUNHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDbEQsbURBQW1EO1FBQ3JELENBQUM7UUFDRyxJQUFJLENBQ0osQ0FBQztZQUNBLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNyQixDQUFDO0lBQ1AsQ0FBQztJQUVELHVDQUFjLEdBQWQsVUFBZSxLQUFLLEVBQUUsUUFBbUI7UUFFdkMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFJLEVBQUMsVUFBVSxFQUFHLFFBQVEsRUFBQyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVELDRDQUFtQixHQUFuQjtRQUNFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNqQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDL0IsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDO1lBQ25CLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO2dCQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ3BELENBQUM7UUFDSCxDQUFDO1FBQ0QsSUFBSTtZQUNGLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFFakIsQ0FBQztJQUVELG9DQUFXLEdBQVg7UUFDRSxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLFNBQVMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDO1lBQ2xELElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0QixDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQztJQUN4QyxDQUFDO0lBMUVVLGNBQWM7UUFEMUIsaUJBQVUsRUFBRTs7T0FDQSxjQUFjLENBMkUxQjtJQUFELHFCQUFDO0NBQUEsQUEzRUQsSUEyRUM7QUEzRVksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb3VjaGJhc2UgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWNvdWNoYmFzZVwiO1xuaW1wb3J0IHsgVXNlckRhdGEgfSBmcm9tIFwiLi4vbW9kZWwvVXNlckRhdGFcIjtcbmltcG9ydCB7IFRvYXN0eSB9IGZyb20gJ25hdGl2ZXNjcmlwdC10b2FzdHknO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ291Y2hkYlNlcnZpY2Uge1xuXG4gIGRhdGFiYXNlIDogQ291Y2hiYXNlIDtcbiAgREFUQUJBU0VfTkFNRSA9IFwidXNlci1kYXRhYmFzZVwiO1xuICB1c2VyRGF0YSA6IFVzZXJEYXRhO1xuICByb3dzIDogYW55O1xuICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gIHByaXZhdGUgaW5pdENvdWNoKCkgOiB2b2lkIHtcbiAgICBpZih0aGlzLmRhdGFiYXNlID09IHVuZGVmaW5lZCl7XG4gICAgICB0aGlzLmRhdGFiYXNlID0gbmV3IENvdWNoYmFzZSh0aGlzLkRBVEFCQVNFX05BTUUpOyAvL2NyZWF0ZSBkYiBpZiBub3QgcHJlc2VudCBvciBnZXRpbnN0YW5jZVxuICAgICAgdGhpcy5kYXRhYmFzZS5jcmVhdGVWaWV3KFwiZ2V0VXNlckRhdGFcIiwgXCIxXCIsIGZ1bmN0aW9uKGRvY3VtZW50LCBlbWl0dGVyKSB7XG4gICAgICAgIGlmKGRvY3VtZW50LnVzZXJkYXRhKSB7XG4gICAgICAgICAgICBlbWl0dGVyLmVtaXQoZG9jdW1lbnQuX2lkLCBkb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVXNlckRhdGFFbnRyeSh1c2VyZGF0YSA6IFVzZXJEYXRhKSA6IE51bWJlciB7XG4gICAgdGhpcy5pbml0Q291Y2goKTtcbiAgICByZXR1cm4gdGhpcy5kYXRhYmFzZS5jcmVhdGVEb2N1bWVudCh7XG4gICAgICBcInVzZXJkYXRhXCIgOiB1c2VyZGF0YVxuICAgIH0pO1xuICB9XG4gIFxuICBnZXRDb3VjaERhdGEoKSB7XG4gICAgaWYodGhpcy5yb3dzID09IHVuZGVmaW5lZCB8fCB0aGlzLnJvd3MubGVuZ3RoID09IDApe1xuICAgICAgdGhpcy5pbml0Q291Y2goKTtcbiAgICAgIGxldCByb3dzID0gdGhpcy5kYXRhYmFzZS5leGVjdXRlUXVlcnkoXCJnZXRVc2VyRGF0YVwiKTtcbiAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGkpXG4gICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocm93c1tpXSkpO1xuICAgICAgfVxuICAgICAgdGhpcy5yb3dzID0gcm93cztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucm93cztcbiAgfVxuXG4gIHNldFVzZXJEYXRhKHVzZXJkYXRhIDogVXNlckRhdGEpe1xuICAgIGlmKHRoaXMuZ2V0Q291Y2hEYXRhKCkubGVuZ3RoID09IDApIC8vIG5ldyB1c2VyXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmNyZWF0ZVVzZXJEYXRhRW50cnkodXNlcmRhdGEpKTtcbiAgICAgIC8vICB0aGlzLkRvY0lkID0gdGhpcy5jcmVhdGVVc2VyRGF0YUVudHJ5KHVzZXJkYXRhKVxuICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICB0aGlzLmdldENvdWNoRGF0YSgpO1xuICAgICAgICB9XG4gIH1cblxuICB1cGRhdGVVc2VyRGF0YShkb2NJZCwgdXNlcmRhdGEgOiBVc2VyRGF0YSlcbiAge1xuICAgIHRoaXMuZGF0YWJhc2UudXBkYXRlRG9jdW1lbnQoZG9jSWQgLCAge1widXNlcmRhdGFcIiA6IHVzZXJkYXRhfSk7XG4gIH1cblxuICBjaGVja0xvZ2dlZEluU3RhdHVzKCkgOiBib29sZWFueyBcbiAgICB0aGlzLmluaXRDb3VjaCgpO1xuICAgIGxldCByb3dzID0gdGhpcy5nZXRDb3VjaERhdGEoKTtcbiAgICBpZihyb3dzLmxlbmd0aCAhPSAwKXtcbiAgICAgIGlmKHJvd3NbMF0udXNlcmRhdGEpe1xuICAgICAgICByZXR1cm4gcm93c1swXS51c2VyZGF0YS5pc0xvZ2dlZEluID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIFxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgXG4gIH1cblxuICBnZXRNZXNzYWdlcygpe1xuICAgIGlmKHRoaXMucm93cyA9PSB1bmRlZmluZWQgfHwgdGhpcy5yb3dzLmxlbmd0aCA9PSAwKXtcbiAgICAgIHRoaXMuZ2V0Q291Y2hEYXRhKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJvd3NbMF0udXNlcmRhdGEubWVzc2FnZXM7XG4gIH1cbn1cbiJdfQ==